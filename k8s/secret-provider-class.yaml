# SecretProviderClass: AWS Secrets Manager?€ Kubernetes Secret???°ë™?˜ëŠ” ë¦¬ì†Œ??
# CSI (Container Storage Interface) Driverë¥??¬ìš©?˜ì—¬ ?ë™?¼ë¡œ Secret ?ì„±
apiVersion: secrets-store.csi.x-k8s.io/v1  # CSI Driver API ë²„ì „
kind: SecretProviderClass                   # ë¦¬ì†Œ???€??
metadata:
  name: fproject-backend-secrets  # SecretProviderClass ?´ë¦„
  namespace: default              # ë°°í¬???¤ì„?¤í˜?´ìŠ¤
spec:
  provider: aws
  parameters:
    # AWS Secrets Manager?ì„œ ê°€?¸ì˜¬ ë¹„ë? ëª©ë¡
    objects: |
      # RDS ?ê²©ì¦ëª… (one-rds-credentials)
      # JSON êµ¬ì¡°: {"dbname":"onedb","username":"oneuser","password":"test1234","host":"...","port":5432}
      - objectName: "one-rds-credentials"      # Secrets Manager??ë¹„ë? ?´ë¦„
        objectType: "secretsmanager"           # ?€??(secretsmanager/parameter)
        jmesPath:                              # JSON ?Œì‹± ê²½ë¡œ
          - path: password                     # JSON??"password" ?„ë“œ ì¶”ì¶œ
            objectAlias: DB_PASSWORD           # Kubernetes Secret?????´ë¦„
      # AWS ?ê²©ì¦ëª… (one-aws-credential)
      # JSON êµ¬ì¡°: {"access_key_id":"AKIA...","secret_access_key":"xM/..."}
      - objectName: "one-aws-credential"
        objectType: "secretsmanager"
        jmesPath:
          - path: access_key_id
            objectAlias: AWS_ACCESS_KEY_ID
          - path: secret_access_key
            objectAlias: AWS_SECRET_ACCESS_KEY
  # Kubernetes Secret ?ë™ ?ì„± ?¤ì •
  secretObjects:
  - secretName: fproject-backend-secret  # ?ì„±??Secret ?´ë¦„ (Deployment?ì„œ ì°¸ì¡°)
    type: Opaque                         # Secret ?€??(Opaque = ?¼ë°˜ Secret)
    data:                                # Secret???€?¥ë  ?°ì´??
    - objectName: DB_PASSWORD            # ?„ì—???•ì˜??objectAlias
      key: DB_PASSWORD                   # Secret?????´ë¦„
    - objectName: AWS_ACCESS_KEY_ID
      key: AWS_ACCESS_KEY_ID
    - objectName: AWS_SECRET_ACCESS_KEY
      key: AWS_SECRET_ACCESS_KEY
# ì°¸ê³ : GOOGLE_CLIENT_SECRET?€ AWS Secrets Manager???†ìœ¼ë¯€ë¡??œì™¸
# ?„ìš”?˜ë©´ journal-api/google-oauth ë¹„ë???Secrets Manager???ì„±?´ì•¼ ??
# ?™ì‘ ë°©ì‹:
# 1. Pod ?œì‘ ??CSI Driverê°€ ???¤ì •???½ìŒ
# 2. ServiceAccount??IAM Roleë¡?Secrets Manager???‘ê·¼
# 3. ë¹„ë???ê°€?¸ì???Kubernetes Secret ?ë™ ?ì„±
# 4. Deploymentê°€ ??Secret???˜ê²½ë³€?˜ë¡œ ì£¼ì…
