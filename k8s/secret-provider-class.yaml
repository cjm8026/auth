# SecretProviderClass: AWS Secrets Manager?� Kubernetes Secret???�동?�는 리소??
# CSI (Container Storage Interface) Driver�??�용?�여 ?�동?�로 Secret ?�성
apiVersion: secrets-store.csi.x-k8s.io/v1  # CSI Driver API 버전
kind: SecretProviderClass                   # 리소???�??
metadata:
  name: fproject-backend-secrets  # SecretProviderClass ?�름
  namespace: default              # 배포???�임?�페?�스
spec:
  provider: aws
  parameters:
    # AWS Secrets Manager?�서 가?�올 비�? 목록
    objects: |
      # RDS ?�격증명 (one-rds-credentials)
      # JSON 구조: {"dbname":"onedb","username":"oneuser","password":"test1234","host":"...","port":5432}
      - objectName: "one-rds-credentials"      # Secrets Manager??비�? ?�름
        objectType: "secretsmanager"           # ?�??(secretsmanager/parameter)
        jmesPath:                              # JSON ?�싱 경로
          - path: password                     # JSON??"password" ?�드 추출
            objectAlias: DB_PASSWORD           # Kubernetes Secret?????�름
      # AWS ?�격증명 (one-aws-credential)
      # JSON 구조: {"access_key_id":"AKIA...","secret_access_key":"xM/..."}
      - objectName: "one-aws-credential"
        objectType: "secretsmanager"
        jmesPath:
          - path: access_key_id
            objectAlias: AWS_ACCESS_KEY_ID
          - path: secret_access_key
            objectAlias: AWS_SECRET_ACCESS_KEY
      # Google OAuth 시크릿 (one-google-oauth)
      # JSON 구조: {"client_id":"...","client_secret":"GOCSPX-..."}
      - objectName: "one-google-oauth"
        objectType: "secretsmanager"
        jmesPath:
          - path: client_secret
            objectAlias: GOOGLE_CLIENT_SECRET
  # Kubernetes Secret ?�동 ?�성 ?�정
  secretObjects:
  - secretName: fproject-backend-secret  # ?�성??Secret ?�름 (Deployment?�서 참조)
    type: Opaque                         # Secret ?�??(Opaque = ?�반 Secret)
    data:                                # Secret???�?�될 ?�이??
    - objectName: DB_PASSWORD            # ?�에???�의??objectAlias
      key: DB_PASSWORD                   # Secret?????�름
    - objectName: AWS_ACCESS_KEY_ID
      key: AWS_ACCESS_KEY_ID
    - objectName: AWS_SECRET_ACCESS_KEY
      key: AWS_SECRET_ACCESS_KEY
    - objectName: GOOGLE_CLIENT_SECRET
      key: GOOGLE_CLIENT_SECRET
# 참고: GOOGLE_CLIENT_SECRET?� AWS Secrets Manager???�으므�??�외
# ?�요?�면 journal-api/google-oauth 비�???Secrets Manager???�성?�야 ??
# ?�작 방식:
# 1. Pod ?�작 ??CSI Driver가 ???�정???�음
# 2. ServiceAccount??IAM Role�?Secrets Manager???�근
# 3. 비�???가?��???Kubernetes Secret ?�동 ?�성
# 4. Deployment가 ??Secret???�경변?�로 주입
