# Service: Pod를 네트워크로 노출하는 리소스
apiVersion: v1       # Kubernetes API 버전
kind: Service        # 리소스 타입
metadata:
  name: fproject-backend-service  # Service 이름 (DNS로 사용됨)
  namespace: default              # 배포할 네임스페이스
  labels:
    app: fproject-backend         # Service에 붙는 레이블 (관리용)
spec:
  type: NodePort     # Service 타입 (ClusterIP/NodePort/LoadBalancer 중 선택)
                     # NodePort: 모든 워커 노드의 특정 포트로 노출
                     # LoadBalancer 대신 NodePort를 사용하여 비용 절감
  ports:
  - port: 80         # Service가 리스닝하는 포트 (클러스터 내부에서 접근 시 사용)
    targetPort: 3001 # Pod의 컨테이너 포트 (실제 앱이 리스닝하는 포트)
    nodePort: 31663  # 워커 노드에서 열리는 포트 (30000-32767 범위)
                     # NLB가 이 포트로 트래픽을 전달함
    protocol: TCP    # 프로토콜 (TCP/UDP)
    name: http       # 포트 이름 (여러 포트가 있을 때 구분용)
  selector:
    app: fproject-backend  # 이 레이블을 가진 Pod로 트래픽 전달
                           # Deployment의 Pod 레이블과 일치해야 함
